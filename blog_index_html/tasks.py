from django.core.mail import send_mail

from celery import shared_task


# 发送邮件验证码，使用task进行异步处理，获取从视图层获取来的值，然后发送到用户邮箱中
@shared_task
def send_email(request, rand_str):
    # f = open('templates/index_page/mail/index.html','rb')
    # mailTEXT = f.read()
    # f.close()
    send_mail(
        subject='Avnext验证码',
        message= '你的验证码为:' + rand_str + '请不要将你的验证码告诉其他人',
        from_email='watch.dog@qq.com',
        recipient_list=[request],
        fail_silently=False
    )
    return (request, rand_str)



from django.core.mail import EmailMultiAlternatives
@shared_task
def send_html_mail(request,rand_str):
    text_content = 'This is an important message.'
    html_content = '<p>This is an <strong>important</strong> message.</p>'
    msg = EmailMultiAlternatives('AVnextCODe', html_content, 'watch.dog@qq.com', [request])
    msg.attach_alternative(html_content, "text/html")
    msg.send()
    return (request, rand_str)