Index: Let/views.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import datetime\r\n\r\nimport pyecharts.charts\r\nimport requests\r\nfrom pyecharts.faker import Faker\r\nfrom pyecharts.globals import ThemeType\r\n\r\nfrom Let.tasks import add\r\nfrom django.shortcuts import render, redirect\r\n\r\nfrom django.http import HttpResponse\r\nimport numpy as np\r\n\r\nfrom pyecharts import options as opts\r\nfrom pyecharts.charts import Line,Page,Grid\r\n\r\npinjun = []\r\n\r\n# 图标数据获取跳转Views\r\nfrom Let import models\r\n\r\n\r\n# 电力数据爬取入库\r\ndef LetView(request):\r\n    import bs4\r\n    import requests\r\n    from bs4 import BeautifulSoup\r\n    res = requests.post(\r\n        url='http://www.wap.cnyiot.com/(S(mjfpk2lgscja02m00mcj3otd))/nat/pay.aspx?mid=19500357280&chInfo=ch_share__chsub_CopyLink&apshareid=7cad8ac6-7aed-4391-b02f-23a9d11fbe37')\r\n    # rex = requests.post(url='http://www.wap.cnyiot.com/(S(jd2c1lijcm5pmagoyoyqr2yk))/nat/pay.aspx?Method=getpayfee')\r\n    soup = bs4.BeautifulSoup(res.text, 'html.parser')\r\n    x = soup.find_all(\"label\")\r\n    end = x[1].string\r\n    if models.elet.objects.filter(dataNum=datetime.datetime.now()):\r\n        print('今日数据已存在')\r\n    else:\r\n        for elenum in models.elet.objects.values_list():\r\n            pinjun.append(int(elenum[3]))\r\n        #下列取出数据库中倒数第二个数据进行加减计算\r\n        enddian = models.elet.objects.all().order_by('electricityNum')\r\n        #将数据库倒数第二个数据赋值给X\r\n        x = enddian[0].electricityNum\r\n        print(x)\r\n        powerend = int(float(x)) - int(float(end))\r\n        pinjunpower = np.mean(pinjun)\r\n        models.elet.objects.create(electricityNum=end, Power_consumption=powerend, Average_power=pinjunpower,\r\n                                   )\r\n    return redirect('http://127.0.0.1:8000/app/test/')\r\n\r\n\r\n##折线图标展示图表展示ViewS\r\n\r\n\r\ndef index(request):\r\n    x = 0\r\n    end = []\r\n    start = []\r\n    pinjun_start = []\r\n\r\n    # x = models.elet.objects.all()\r\n    # print(x.values_list())\r\n    for elenum in models.elet.objects.values_list():\r\n        end.append(elenum[1])\r\n        start.append(elenum[2])\r\n        pinjun.append(int(elenum[3]))\r\n        pinjun_start.append(int(elenum[4]))\r\n    # for test in models.elet.objects.values_list():\r\n    #         pinjun.append(test[3])\r\n    c = (\r\n        Line()\r\n        .add_xaxis(end)\r\n        .add_yaxis(\"昨日耗电量\", pinjun, itemstyle_opts=opts.ItemStyleOpts(border_width=3), )\r\n        .add_yaxis(\"总表电量\", start, itemstyle_opts=opts.ItemStyleOpts(border_width=3))\r\n        .add_yaxis(\"平均每日耗电量\", pinjun_start, itemstyle_opts=opts.ItemStyleOpts(border_width=3))\r\n        .set_global_opts(title_opts=opts.TitleOpts(title=\"电力走势图\", subtitle=\"我是副标题\",pos_left='7%'),\r\n                         datazoom_opts=opts.DataZoomOpts(orient=\"horizontal\"),\r\n                         tooltip_opts=opts.TooltipOpts(axis_pointer_type=\"cross\"),legend_opts=opts.LegendOpts(pos_left=\"25%\"))\r\n    )\r\n    from pyecharts.charts import Bar\r\n    bar = (\r\n        Bar()\r\n        .add_xaxis(Faker.choose())\r\n        .add_yaxis(\"商家A\", Faker.values())\r\n        .add_yaxis(\"商家B\", Faker.values())\r\n        .set_global_opts(title_opts=opts.TitleOpts(title=\"Grid-Bar\",pos_right='7%'),legend_opts=opts.LegendOpts(pos_right=\"25%\"))\r\n    )\r\n    Page = (\r\n        Grid(init_opts=opts.InitOpts(width=\"1800px\", height=\"600px\"))\r\n        # 通过设置图形相对位置，来调整是整个并行图是竖直放置，还是水平放置\r\n        .add(c,grid_opts=opts.GridOpts(pos_right=\"60%\"))\r\n        .add(bar,grid_opts=opts.GridOpts(pos_left=\"60%\"))\r\n    )\r\n    return HttpResponse(Page.render_embed())\r\n\r\n\r\n# ##视图测试ViewS\r\n# def test(request):\r\n#     enddian = models.elet.objects.all().order_by('electricityNum') #将选择数据库指定的字段转换成列表\r\n#     x = enddian[1].electricityNum #选择字段的倒数第一个，可以获取字段的\r\n#     print(int(float(x)))\r\n#     y = enddian[0].electricityNum\r\n#     print(int(float(y)))\r\n#     return render(request,'index.html')\r\n#\r\n\r\n\r\n# 个人界面-集成电力图\r\ndef index_div(request):\r\n    timesdata = models.elet.objects.all()\r\n    return render(request, 'index_page/user/index.html', {'timesdata': timesdata})\r\n\r\n\r\n##主页新闻页面\r\n# def news_index(request):\r\n#     res = requests.get(\r\n#         'https://i.news.qq.com/trpc.qqnews_web.pc_base_srv.base_http_proxy/NinjaPageContentSync?pull_urls=news_top_2018')\r\n#     date_list = res.json()\r\n#     x = date_list['data']\r\n#     for test in x:\r\n#         if test['img_url'] == '':\r\n#             continue\r\n#         else:\r\n#             end_jpg = requests.get(test['img_url'])\r\n#             file = open('Let/static/images/News_jpg/' + test['article_id'] + '.png', 'w')\r\n#             file.close()\r\n#             with open('Let/static/images/News_jpg/' + test['article_id'] + '.png', 'wb') as file:\r\n#                 # 每128个流遍历一次\r\n#                 for data in end_jpg.iter_content(128):\r\n#                     # 把流写入到文件，这个文件最后写入完成就是，selenium.png\r\n#                     file.write(data)  # data相当于一块一块数据写入到我们的图片文件中\r\n#     # for i in x:\r\n#     #     end_list_url = i['url']\r\n#     #     title = i['title']\r\n#     #     imgurl = i['img_url']\r\n#     return render(request, 'index_page/news_index.html', {'news': x, })\r\n\r\n\r\n##此函数测试纯同步将新闻显示到前端中,速度极慢,打算测试异步\r\ndef news_test(request):\r\n    res = requests.get(\r\n        'https://i.news.qq.com/trpc.qqnews_web.pc_base_srv.base_http_proxy/NinjaPageContentSync?pull_urls=news_top_2018')\r\n    date_list = res.json()\r\n    x = date_list['data']\r\n    for test in x:\r\n        print(test['img_url'])\r\n        if test['img_url'] == '':\r\n            continue\r\n        else:\r\n            end_jpg = requests.get(test['img_url'])\r\n            file = open('Let/static/images/News_jpg/' + test['article_id'] + '.png', 'w')\r\n            file.close()\r\n            with open('Let/static/images/News_jpg/' + test['article_id'] + '.png', 'wb') as file:\r\n                # 每128个流遍历一次\r\n                for data in end_jpg.iter_content(128):\r\n                    # 把流写入到文件，这个文件最后写入完成就是，selenium.png\r\n                    file.write(data)  # data相当于一块一块数据写入到我们的图片文件中\r\n    return render(request, 'index_page/news/1.html', {'news': x})\r\n\r\n\r\n##此函数测试将新闻数据加到数据库中\r\ndef newsadd(request):\r\n    res = requests.get(\r\n        'https://i.news.qq.com/trpc.qqnews_web.pc_base_srv.base_http_proxy/NinjaPageContentSync?pull_urls=news_top_2018')\r\n    date_list = res.json()\r\n    x = date_list['data']\r\n    for i in x:\r\n        if i['img_url'] == '':\r\n            continue\r\n        else:\r\n            models.news.objects.get_or_create(news_title=i['title'], news_url=i['url'], img_url=i['img_url'],\r\n                                              news_group=i['group'])\r\n    return redirect('http://127.0.0.1:8000/app/index/')\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Let/views.py b/Let/views.py
--- a/Let/views.py	(revision ad0590700ec62ec7cb7d97235018d49636e7ea6c)
+++ b/Let/views.py	(date 1665058728237)
@@ -85,7 +85,7 @@
         .set_global_opts(title_opts=opts.TitleOpts(title="Grid-Bar",pos_right='7%'),legend_opts=opts.LegendOpts(pos_right="25%"))
     )
     Page = (
-        Grid(init_opts=opts.InitOpts(width="1800px", height="600px"))
+        Grid(init_opts=opts.InitOpts(width="1900px", height="500px"))
         # 通过设置图形相对位置，来调整是整个并行图是竖直放置，还是水平放置
         .add(c,grid_opts=opts.GridOpts(pos_right="60%"))
         .add(bar,grid_opts=opts.GridOpts(pos_left="60%"))
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"26649c44-2b48-45ab-b14a-a06f85d4081b\" name=\"Changes\" comment=\"\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/Let/views.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/Let/views.py\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"DjangoConsoleOptions\" custom-start-script=\"import sys; print('Python %s on %s' % (sys.version, sys.platform))&#10;import django; print('Django %s' % django.get_version())&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;if 'setup' in dir(django): django.setup()&#10;import django_manage_shell; django_manage_shell.run(PROJECT_ROOT)\">\r\n    <option name=\"myCustomStartScript\" value=\"import sys; print('Python %s on %s' % (sys.version, sys.platform))&#10;import django; print('Django %s' % django.get_version())&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;if 'setup' in dir(django): django.setup()&#10;import django_manage_shell; django_manage_shell.run(PROJECT_ROOT)\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"CSS File\" />\r\n        <option value=\"Python Script\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"FlaskConsoleOptions\" custom-start-script=\"import sys&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo&#10;locals().update(ScriptInfo(create_app=None).load_app().make_shell_context())&#10;print(&quot;Python %s on %s\\nApp: %s [%s]\\nInstance: %s&quot; % (sys.version, sys.platform, app.import_name, app.env, app.instance_path))\">\r\n    <envs>\r\n      <env key=\"FLASK_APP\" value=\"app\" />\r\n    </envs>\r\n    <option name=\"myCustomStartScript\" value=\"import sys&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo&#10;locals().update(ScriptInfo(create_app=None).load_app().make_shell_context())&#10;print(&quot;Python %s on %s\\nApp: %s [%s]\\nInstance: %s&quot; % (sys.version, sys.platform, app.import_name, app.env, app.instance_path))\" />\r\n    <option name=\"myEnvs\">\r\n      <map>\r\n        <entry key=\"FLASK_APP\" value=\"app\" />\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitToolBoxStore\">\r\n    <option name=\"projectConfigVersion\" value=\"5\" />\r\n  </component>\r\n  <component name=\"MarkdownSettingsMigration\">\r\n    <option name=\"stateVersion\" value=\"1\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"2F4PN6FEUnK8Dl9EkvddzbisPaF\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;RunOnceActivity.OpenProjectViewOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;WebServerToolWindowFactoryState&quot;: &quot;false&quot;,\r\n    &quot;last_opened_file_path&quot;: &quot;E:/Exploit_blog/templates/index_page&quot;,\r\n    &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,\r\n    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;settings.editor.selected.configurable&quot;: &quot;http.proxy&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"E:\\Exploit_blog\\templates\\index_page\" />\r\n      <recent name=\"E:\\Exploit_blog\\blog_index_html\\static\\images\" />\r\n      <recent name=\"E:\\Exploit_blog\\blog_index_html\\static\\js\" />\r\n      <recent name=\"E:\\Exploit_blog\\blog_index_html\\static\\css\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"Unnamed\" type=\"Python.DjangoServer\" factoryName=\"Django server\" nameIsGenerated=\"true\">\r\n      <module name=\"Exploit_blog\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n        <env name=\"DJANGO_SETTINGS_MODULE\" value=\"djangoProject1.settings\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"D:\\PYTHON3\\python.exe\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <option name=\"launchJavascriptDebuger\" value=\"false\" />\r\n      <option name=\"port\" value=\"8000\" />\r\n      <option name=\"host\" value=\"127.0.0.1\" />\r\n      <option name=\"additionalOptions\" value=\"\" />\r\n      <option name=\"browserUrl\" value=\"\" />\r\n      <option name=\"runTestServer\" value=\"false\" />\r\n      <option name=\"runNoReload\" value=\"false\" />\r\n      <option name=\"useCustomRunCommand\" value=\"false\" />\r\n      <option name=\"customRunCommand\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"26649c44-2b48-45ab-b14a-a06f85d4081b\" name=\"Changes\" comment=\"\" />\r\n      <created>1663748340041</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1663748340041</updated>\r\n      <workItem from=\"1663748342387\" duration=\"3464000\" />\r\n      <workItem from=\"1663759543104\" duration=\"929000\" />\r\n      <workItem from=\"1663826984117\" duration=\"2171000\" />\r\n      <workItem from=\"1663848074464\" duration=\"230000\" />\r\n      <workItem from=\"1663848434199\" duration=\"1638000\" />\r\n      <workItem from=\"1663939547160\" duration=\"3899000\" />\r\n      <workItem from=\"1663979911373\" duration=\"4105000\" />\r\n      <workItem from=\"1664767147128\" duration=\"707000\" />\r\n      <workItem from=\"1664767871290\" duration=\"204000\" />\r\n      <workItem from=\"1664856524933\" duration=\"137000\" />\r\n      <workItem from=\"1665044014905\" duration=\"3905000\" />\r\n      <workItem from=\"1665055008720\" duration=\"3622000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"文章详情页面优化\">\r\n      <created>1663750880078</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1663750880078</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"tasks.py 文件迁移-测试发送邮件\">\r\n      <created>1663829104303</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1663829104303</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"tasks.py 文件迁移-测试发送邮件\">\r\n      <created>1663850065827</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1663850065827</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"文件bug修复\">\r\n      <created>1663944737660</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1663944737660</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"HTML-验证码邮件发送\">\r\n      <created>1663983351035</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1663983351035</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"HTML-验证码邮件发送\">\r\n      <created>1664767565988</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1664767565988</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"注释增加\">\r\n      <created>1665046732501</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1665046732501</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"修改自动测试版本\">\r\n      <created>1665046857665</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1665046857665</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00009\" summary=\"图表布局优化\">\r\n      <created>1665056938343</created>\r\n      <option name=\"number\" value=\"00009\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1665056938343</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"10\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"文章详情页面优化\" />\r\n    <MESSAGE value=\"tasks.py 文件迁移-测试发送邮件\" />\r\n    <MESSAGE value=\"文件bug修复\" />\r\n    <MESSAGE value=\"HTML-验证码邮件发送\" />\r\n    <MESSAGE value=\"注释增加\" />\r\n    <MESSAGE value=\"修改自动测试版本\" />\r\n    <MESSAGE value=\"图表布局优化\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"图表布局优化\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision ad0590700ec62ec7cb7d97235018d49636e7ea6c)
+++ b/.idea/workspace.xml	(date 1665058807900)
@@ -111,7 +111,7 @@
       <workItem from="1664767871290" duration="204000" />
       <workItem from="1664856524933" duration="137000" />
       <workItem from="1665044014905" duration="3905000" />
-      <workItem from="1665055008720" duration="3622000" />
+      <workItem from="1665055008720" duration="3795000" />
     </task>
     <task id="LOCAL-00001" summary="文章详情页面优化">
       <created>1663750880078</created>
@@ -176,7 +176,14 @@
       <option name="project" value="LOCAL" />
       <updated>1665056938343</updated>
     </task>
-    <option name="localTasksCounter" value="10" />
+    <task id="LOCAL-00010" summary="图表布局优化">
+      <created>1665058640402</created>
+      <option name="number" value="00010" />
+      <option name="presentableId" value="LOCAL-00010" />
+      <option name="project" value="LOCAL" />
+      <updated>1665058640402</updated>
+    </task>
+    <option name="localTasksCounter" value="11" />
     <servers />
   </component>
   <component name="TypeScriptGeneratedFilesManager">
