import random
from urllib import request

from django.shortcuts import render, redirect
import requests


import datetime

import requests

from django.shortcuts import render, redirect

from django.http import HttpResponse
import numpy as np

from pyecharts import options as opts
from pyecharts.charts import Line

from user_borad import models



#邮件发件测试
from django.core.mail import send_mail
def send_email(request):
    send_mail(
        subject='测试网站标题',
        message='测试网站内容',
        from_email='watch.dog@qq.com',
        recipient_list=['watch.dog@qq.com'],
        fail_silently=False
    )
    return request('OK')


def user_reg(request):
    email_cod = []
    if request.method == 'GET':
        return render(request, 'index_page/user_reg.html')
    if request.method == 'POST':
        import random
        str1 = '0123456789'
        rand_str = ''
        for i in range(0, 6):
            rand_str += str1[random.randrange(0, len(str1))]

        rename = request.POST.get('Rname')
        username = request.POST.get('name')
        password = request.POST.get('password')
        email = request.POST.get('email')
        Pbbool = models.user.objects.filter(username=username).exists()##用户是否存在验证
        if Pbbool:
            x = ('该用户已经存在')
            return render(request,'index_page/user_reg.html',{'x':x})
        else:
            models.user.objects.create(user_Rename=rename, username=username, password=password, useremail=email,
                                       user_acict_statu=0)
            send_mail(
                     subject='测试网站标题',
                     message='你的验证码为:'+ rand_str +'请不要将你的验证码告诉其他人',
                     from_email='watch.dog@qq.com',
                     recipient_list= [email] ,
                     fail_silently=False)

            return redirect('/user/user_code/')





def user_login(request):
    if request.method == 'GET':
        return render(request, 'index_page/user_login.html')
    if request.method == 'POST':
        username = request.POST.get('name')
        password = request.POST.get('password')
        if username == models.user.objects.get('username') and password == models.user.objects.get('password'):
            return redirect('http://127.0.0.1:8000/app/index/')




def user_code(request):

    return render(request,'index_page/user_code.html')



